<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Privado com Senha</title>
  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #eee; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    #loginScreen, #chatScreen { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    #loginScreen { background: #222; }
    #chatScreen { display: none; flex-direction: column; height: 100vh; }
    #messages { flex: 1; overflow-y: auto; padding: 10px; background: #1e1e1e; width: 100%; max-width: 600px; box-sizing: border-box; }
    #messages div { margin-bottom: 10px; }
    #messages .user { font-weight: bold; color: #6cf; }
    #inputArea { display: flex; padding: 10px; max-width: 600px; width: 100%; box-sizing: border-box; background: #222; }
    #inputArea input[type=text] { flex: 1; padding: 8px; border: none; border-radius: 4px; font-size: 16px; }
    #inputArea button { margin-left: 10px; padding: 8px 16px; font-size: 16px; border: none; border-radius: 4px; background: #6cf; color: #000; cursor: pointer; }
    #inputArea button:hover { background: #58a; }
    .error { color: #f44; margin-top: 10px; }
  </style>
</head>
<body>

  <div id="loginScreen">
    <h2>Entre com a senha para acessar o chat</h2>
    <input type="password" id="passwordInput" placeholder="Digite a senha" autocomplete="off" />
    <button id="loginButton">Entrar</button>
    <div id="loginError" class="error"></div>
  </div>

  <div id="chatScreen">
    <div id="messages"></div>
    <div id="inputArea">
      <input type="text" id="messageInput" placeholder="Digite sua mensagem..." autocomplete="off" />
      <button id="sendButton">Enviar</button>
    </div>
  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
  <script>
    // Configurações do Supabase com sua URL e chave pública
    const SUPABASE_URL = 'https://birwaspfxawbpekpaqpk.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpcndhc3BmeGF3YnBla3BhcXBrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczODY0NDMsImV4cCI6MjA2Mjk2MjQ0M30.32GsuRNRdJi7v_lHklC1hB7OxSG6F-AcHD_QBF0CpVs';

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Variáveis
    const senhaCorreta = '458';
    let usuarioNome = 'Usuário' + Math.floor(Math.random() * 1000);

    // Elementos DOM
    const loginScreen = document.getElementById('loginScreen');
    const chatScreen = document.getElementById('chatScreen');
    const loginButton = document.getElementById('loginButton');
    const passwordInput = document.getElementById('passwordInput');
    const loginError = document.getElementById('loginError');
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // ID do canal/chat privado (fixo)
    const canalID = 'chatprivado458';

    // Mostrar mensagens no chat
    function mostrarMensagem(data) {
      const div = document.createElement('div');
      div.innerHTML = `<span class="user">${data.usuario}:</span> ${data.mensagem}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Carregar mensagens antigas
    async function carregarMensagens() {
      const { data, error } = await supabase
        .from('mensagens')
        .select('*')
        .eq('canal', canalID)
        .order('created_at', { ascending: true });

      if (!error && data) {
        messagesDiv.innerHTML = '';
        data.forEach(mostrarMensagem);
      }
    }

    // Escutar novas mensagens em tempo real
    function escutarMensagens() {
      supabase
        .channel('mensagens')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'mensagens', filter: `canal=eq.${canalID}` }, payload => {
          mostrarMensagem(payload.new);
        })
        .subscribe();
    }

    // Enviar mensagem
    async function enviarMensagem() {
      const texto = messageInput.value.trim();
      if (texto === '') return;

      await supabase.from('mensagens').insert([
        { canal: canalID, usuario: usuarioNome, mensagem: texto }
      ]);

      messageInput.value = '';
    }

    // Eventos
    sendButton.addEventListener('click', enviarMensagem);
    messageInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') enviarMensagem();
    });

    loginButton.addEventListener('click', () => {
      if (passwordInput.value === senhaCorreta) {
        loginScreen.style.display = 'none';
        chatScreen.style.display = 'flex';
        carregarMensagens();
        escutarMensagens();
      } else {
        loginError.textContent = 'Senha incorreta, tente novamente.';
      }
    });
  </script>
</body>
</html>
